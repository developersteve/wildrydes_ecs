{"version":3,"file":"types.js","sourceRoot":"","sources":["../../src/types.ts"],"names":[],"mappings":";;;AAIa,QAAA,UAAU,GAAkB,MAAM,CAAC,0CAA0C,CAAC,CAAC;AAC/E,QAAA,QAAQ,GAAkB,MAAM,CAAC,0CAA0C,CAAC,CAAC;AAC7E,QAAA,kBAAkB,GAAkB,MAAM,CAAC,kDAAkD,CAAC,CAAC;AAC/F,QAAA,oBAAoB,GAAkB,MAAM,CAAC,4CAA4C,CAAC,CAAC;AAE3F,QAAA,gCAAgC,GAAG;IAC5C,iQAAiQ;IACjQ,kBAAkB,EAAE,oBAAoB;IAExC,gOAAgO;IAChO,wBAAwB,EAAE,0BAA0B;IAEpD,2JAA2J;IAC3J,oBAAoB,EAAE,sBAAsB;IAE5C,wLAAwL;IACxL,8BAA8B,EAAE,gCAAgC;IAEhE,sNAAsN;IACtN,iBAAiB,EAAE,mBAAmB;CACzC,CAAC","sourcesContent":["import { Span } from '@opentelemetry/api';\nimport type express from 'express';\nimport { InstrumentationConfig } from '@opentelemetry/instrumentation';\n\nexport const PATH_STORE: unique symbol = Symbol('opentelemetry.express.express-layer-path');\nexport const REQ_SPAN: unique symbol = Symbol('opentelemetry.express.express-span-store');\nexport const EXCEPTION_RECORDED: unique symbol = Symbol('opentelemetry.express.express-exception-recorded');\nexport const CONSUMED_ROUTE_STATE: unique symbol = Symbol('opentelemetry.express.consumed-route-state');\n\nexport const ExpressInstrumentationAttributes = {\n    /** This attribute will always contain the entire path. The part of the path that has been consumed by express will be shown as is (parameterized), and the leftover will be concatenated after (due to early termination or middleware that accept any path). */\n    EXPRESS_ROUTE_FULL: 'express.route.full',\n\n    /** This attribute is relevant when user configures multi path options for the same middleware. It reduces even further the cardinality space compared to `http.route`, and supply more info about how the app routing works. */\n    EXPRESS_ROUTE_CONFIGURED: 'express.route.configured',\n\n    /** This attribute holds a json stringified map, where the keys are the url path param names, and the values are the matched params from the actual url. */\n    EXPRESS_ROUTE_PARAMS: 'express.route.params',\n\n    /** In case of internal error in instrumentation, this attribute will contain the error description. There are no known valid use cases which are expected to produce this attribute. */\n    EXPRESS_INSTRUMENTATION_ERRORS: 'express.instrumentation.errors',\n\n    /** Set to true when request was not handled by any middleware in express, and got fallback to the default app `finalhandler`. This can happen if user sent request with invalid path or method (resulting in 404). */\n    EXPRESS_UNHANDLED: 'express.unhandled',\n};\n\nexport type LayerPathAlternative = {\n    userSuppliedValue: string | RegExp;\n    displayValue: string;\n    regexp: RegExp;\n};\n\nexport type LayerPath = {\n    fastSlash: boolean;\n    alternatives: LayerPathAlternative | LayerPathAlternative[];\n    displayValue: string;\n};\n\nexport interface ExpressConsumedRouteState {\n    resolvedRoute?: string;\n    remainingRoute?: string;\n    configuredRoute?: string;\n    params?: Record<string, string>;\n    isUnhandled?: boolean; // true when we are in the context of the final handler\n    errors?: string[];\n}\n\nexport type Parameters<T> = T extends (...args: infer T) => any ? T : unknown[];\nexport type PatchedRequest = {\n    [REQ_SPAN]?: Span;\n    [CONSUMED_ROUTE_STATE]?: ExpressConsumedRouteState;\n    __ot_middlewares?: string[]; // patch to forward the route to http instrumentation\n} & express.Request;\nexport type PathParams = string | RegExp | Array<string | RegExp>;\n\n// https://github.com/expressjs/express/blob/master/lib/router/index.js#L53\nexport type ExpressRouter = {\n    params: { [key: string]: string };\n    _params: string[];\n    caseSensitive: boolean;\n    mergeParams: boolean;\n    strict: boolean;\n    stack: ExpressLayer[];\n};\n\n// https://github.com/expressjs/express/blob/master/lib/router/layer.js#L33\nexport type ExpressLayer = {\n    prototype: {\n        handle_error: express.ErrorRequestHandler;\n        handle_request: express.RequestHandler;\n    };\n    handle: Function;\n    [PATH_STORE]?: LayerPath;\n    name: string;\n    params: { [key: string]: string };\n    path: string;\n    regexp: RegExp;\n};\n\nexport interface ExpressRequestHookInformation {\n    moduleVersion?: string;\n    req: express.Request;\n    res: express.Response;\n}\n\nexport type RequestHook = (span: Span, requestInfo: ExpressRequestHookInformation) => void;\n\nexport interface ExpressInstrumentationConfig extends InstrumentationConfig {\n    /** Hook for adding custom attributes before express start handling the request */\n    requestHook?: RequestHook;\n\n    /** If set to true, plugin will include semantic http attributes in each express span */\n    includeHttpAttributes?: boolean;\n}\n"]}